<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Microsoft Sentinel を使って GitHub Enterprise Cloud のセキュリティを強化しよう (Azure Logic Apps コネクタ編) | クラウドCoEの何でも屋</title><meta name=keywords content="Azure,Microsoft Sentinel,GitHub,Azure Logic Apps"><meta name=description content="はじめに みなさん、こんにちは。今回は GitHub Enterprise Cloud(GHEC) の各種ログを SIEM1 マネージドサービスである Microsoft Sentinel (旧称 Azure Sentinel) に集約し、サイバー攻撃の兆候を検知できるようにする方法をご紹介していきたいと思います。
Microsoft Sentinel と GHEC との連携方法はいくつかあるのですが、この記事では Microsoft Sentinel コミュニティで開発している Azure Logic Apps(ロジックアプリ)、Azure Functions(関数アプリ)の 2 種類のカスタムデータコネクタの内、「Azure Logic Apps コネクタ」を使った方法をご紹介していきたいと思います。
これから GHEC の利用を検討している方や、GHEC は利用しているけれど SIEM システムの導入まではしていないという方は、セキュリティ強化策のひとつとして参考にしてみてはいかがでしょうか。
構築するシステムについて 今回は Azure Logic Apps(ロジックアプリ)を定期的に起動し、GHEC から監査ログなどを取得して Microsoft Sentinel ワークスペースへ格納、格納されたログに対して Microsoft Sentinel が自動的に相関分析をかけていく、といった流れで処理を行うシステムを構築していきたいと思います。
Azure Sentinel とのコネクタについては、今回は Microsoft Sentinel コミュニティで公開されている次のカスタムデータコネクタを利用していきます。
https://github.com/Azure/Azure-Sentinel/tree/master/DataConnectors/GitHub
本カスタムコネクタをデプロイすると、次の 3 種類の Azure Logic Apps リソースが動作するようになります。
   リソース種別 説明     Audit Playbook 監査ログを定期的に収集する自動ワークフロー (デフォルト 5 分間隔)   Repo Playbook 各リポジトリに対するフォーク、クローン、コミットなどの操作ログを定期的に収集する自動ワークフロー (デフォルト 1 時間間隔)   Vulnerability Alert Playbook 各リポジトリに対するセキュリティ脆弱性診断ログを定期的に収集する自動ワークフロー (デフォルト 1 日間隔)    また、本カスタムコネクタで取得した各種ログデータについては、Log Analytics ワークスペースの次のカスタムテーブルへ格納されるようになります。"><meta name=author content><link rel=canonical href=https://chacco38.github.io/posts/2021/11/azure-sentinel-logicapps-data-connector-for-ghec/><link crossorigin=anonymous href=/assets/css/stylesheet.min.317d4c109e98a8137e18d0fd1222603a2a157f4e40f59a79576eb3861cc09531.css integrity="sha256-MX1MEJ6YqBN+GND9EiJgOioVf05A9Zp5V26zhhzAlTE=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.4dcb3c4f38462f66c6b6137227726f5543cb934cca9788f041c087e374491df2.js integrity="sha256-Tcs8TzhGL2bGthNyJ3JvVUPLk0zKl4jwQcCH43RJHfI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://chacco38.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://chacco38.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://chacco38.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://chacco38.github.io/apple-touch-icon.png><link rel=mask-icon href=https://chacco38.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Microsoft Sentinel を使って GitHub Enterprise Cloud のセキュリティを強化しよう (Azure Logic Apps コネクタ編)"><meta property="og:description" content="はじめに みなさん、こんにちは。今回は GitHub Enterprise Cloud(GHEC) の各種ログを SIEM1 マネージドサービスである Microsoft Sentinel (旧称 Azure Sentinel) に集約し、サイバー攻撃の兆候を検知できるようにする方法をご紹介していきたいと思います。
Microsoft Sentinel と GHEC との連携方法はいくつかあるのですが、この記事では Microsoft Sentinel コミュニティで開発している Azure Logic Apps(ロジックアプリ)、Azure Functions(関数アプリ)の 2 種類のカスタムデータコネクタの内、「Azure Logic Apps コネクタ」を使った方法をご紹介していきたいと思います。
これから GHEC の利用を検討している方や、GHEC は利用しているけれど SIEM システムの導入まではしていないという方は、セキュリティ強化策のひとつとして参考にしてみてはいかがでしょうか。
構築するシステムについて 今回は Azure Logic Apps(ロジックアプリ)を定期的に起動し、GHEC から監査ログなどを取得して Microsoft Sentinel ワークスペースへ格納、格納されたログに対して Microsoft Sentinel が自動的に相関分析をかけていく、といった流れで処理を行うシステムを構築していきたいと思います。
Azure Sentinel とのコネクタについては、今回は Microsoft Sentinel コミュニティで公開されている次のカスタムデータコネクタを利用していきます。
https://github.com/Azure/Azure-Sentinel/tree/master/DataConnectors/GitHub
本カスタムコネクタをデプロイすると、次の 3 種類の Azure Logic Apps リソースが動作するようになります。
   リソース種別 説明     Audit Playbook 監査ログを定期的に収集する自動ワークフロー (デフォルト 5 分間隔)   Repo Playbook 各リポジトリに対するフォーク、クローン、コミットなどの操作ログを定期的に収集する自動ワークフロー (デフォルト 1 時間間隔)   Vulnerability Alert Playbook 各リポジトリに対するセキュリティ脆弱性診断ログを定期的に収集する自動ワークフロー (デフォルト 1 日間隔)    また、本カスタムコネクタで取得した各種ログデータについては、Log Analytics ワークスペースの次のカスタムテーブルへ格納されるようになります。"><meta property="og:type" content="article"><meta property="og:url" content="https://chacco38.github.io/posts/2021/11/azure-sentinel-logicapps-data-connector-for-ghec/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-11-26T00:00:00+00:00"><meta property="article:modified_time" content="2021-11-26T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Microsoft Sentinel を使って GitHub Enterprise Cloud のセキュリティを強化しよう (Azure Logic Apps コネクタ編)"><meta name=twitter:description content="はじめに みなさん、こんにちは。今回は GitHub Enterprise Cloud(GHEC) の各種ログを SIEM1 マネージドサービスである Microsoft Sentinel (旧称 Azure Sentinel) に集約し、サイバー攻撃の兆候を検知できるようにする方法をご紹介していきたいと思います。
Microsoft Sentinel と GHEC との連携方法はいくつかあるのですが、この記事では Microsoft Sentinel コミュニティで開発している Azure Logic Apps(ロジックアプリ)、Azure Functions(関数アプリ)の 2 種類のカスタムデータコネクタの内、「Azure Logic Apps コネクタ」を使った方法をご紹介していきたいと思います。
これから GHEC の利用を検討している方や、GHEC は利用しているけれど SIEM システムの導入まではしていないという方は、セキュリティ強化策のひとつとして参考にしてみてはいかがでしょうか。
構築するシステムについて 今回は Azure Logic Apps(ロジックアプリ)を定期的に起動し、GHEC から監査ログなどを取得して Microsoft Sentinel ワークスペースへ格納、格納されたログに対して Microsoft Sentinel が自動的に相関分析をかけていく、といった流れで処理を行うシステムを構築していきたいと思います。
Azure Sentinel とのコネクタについては、今回は Microsoft Sentinel コミュニティで公開されている次のカスタムデータコネクタを利用していきます。
https://github.com/Azure/Azure-Sentinel/tree/master/DataConnectors/GitHub
本カスタムコネクタをデプロイすると、次の 3 種類の Azure Logic Apps リソースが動作するようになります。
   リソース種別 説明     Audit Playbook 監査ログを定期的に収集する自動ワークフロー (デフォルト 5 分間隔)   Repo Playbook 各リポジトリに対するフォーク、クローン、コミットなどの操作ログを定期的に収集する自動ワークフロー (デフォルト 1 時間間隔)   Vulnerability Alert Playbook 各リポジトリに対するセキュリティ脆弱性診断ログを定期的に収集する自動ワークフロー (デフォルト 1 日間隔)    また、本カスタムコネクタで取得した各種ログデータについては、Log Analytics ワークスペースの次のカスタムテーブルへ格納されるようになります。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://chacco38.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Microsoft Sentinel を使って GitHub Enterprise Cloud のセキュリティを強化しよう (Azure Logic Apps コネクタ編)","item":"https://chacco38.github.io/posts/2021/11/azure-sentinel-logicapps-data-connector-for-ghec/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Microsoft Sentinel を使って GitHub Enterprise Cloud のセキュリティを強化しよう (Azure Logic Apps コネクタ編)","name":"Microsoft Sentinel を使って GitHub Enterprise Cloud のセキュリティを強化しよう (Azure Logic Apps コネクタ編)","description":"はじめに みなさん、こんにちは。今回は GitHub Enterprise Cloud(GHEC) の各種ログを SIEM1 マネージドサービスである Microsoft Sentinel (旧称 Azure Sentinel) に集約し、サイバー攻撃の兆候を検知できるようにする方法をご紹介していきたいと思います。\nMicrosoft Sentinel と GHEC との連携方法はいくつかあるのですが、この記事では Microsoft Sentinel コミュニティで開発している Azure Logic Apps(ロジックアプリ)、Azure Functions(関数アプリ)の 2 種類のカスタムデータコネクタの内、「Azure Logic Apps コネクタ」を使った方法をご紹介していきたいと思います。\nこれから GHEC の利用を検討している方や、GHEC は利用しているけれど SIEM システムの導入まではしていないという方は、セキュリティ強化策のひとつとして参考にしてみてはいかがでしょうか。\n構築するシステムについて 今回は Azure Logic Apps(ロジックアプリ)を定期的に起動し、GHEC から監査ログなどを取得して Microsoft Sentinel ワークスペースへ格納、格納されたログに対して Microsoft Sentinel が自動的に相関分析をかけていく、といった流れで処理を行うシステムを構築していきたいと思います。\nAzure Sentinel とのコネクタについては、今回は Microsoft Sentinel コミュニティで公開されている次のカスタムデータコネクタを利用していきます。\nhttps://github.com/Azure/Azure-Sentinel/tree/master/DataConnectors/GitHub\n本カスタムコネクタをデプロイすると、次の 3 種類の Azure Logic Apps リソースが動作するようになります。\n   リソース種別 説明     Audit Playbook 監査ログを定期的に収集する自動ワークフロー (デフォルト 5 分間隔)   Repo Playbook 各リポジトリに対するフォーク、クローン、コミットなどの操作ログを定期的に収集する自動ワークフロー (デフォルト 1 時間間隔)   Vulnerability Alert Playbook 各リポジトリに対するセキュリティ脆弱性診断ログを定期的に収集する自動ワークフロー (デフォルト 1 日間隔)    また、本カスタムコネクタで取得した各種ログデータについては、Log Analytics ワークスペースの次のカスタムテーブルへ格納されるようになります。","keywords":["Azure","Microsoft Sentinel","GitHub","Azure Logic Apps"],"articleBody":"はじめに みなさん、こんにちは。今回は GitHub Enterprise Cloud(GHEC) の各種ログを SIEM1 マネージドサービスである Microsoft Sentinel (旧称 Azure Sentinel) に集約し、サイバー攻撃の兆候を検知できるようにする方法をご紹介していきたいと思います。\nMicrosoft Sentinel と GHEC との連携方法はいくつかあるのですが、この記事では Microsoft Sentinel コミュニティで開発している Azure Logic Apps(ロジックアプリ)、Azure Functions(関数アプリ)の 2 種類のカスタムデータコネクタの内、「Azure Logic Apps コネクタ」を使った方法をご紹介していきたいと思います。\nこれから GHEC の利用を検討している方や、GHEC は利用しているけれど SIEM システムの導入まではしていないという方は、セキュリティ強化策のひとつとして参考にしてみてはいかがでしょうか。\n構築するシステムについて 今回は Azure Logic Apps(ロジックアプリ)を定期的に起動し、GHEC から監査ログなどを取得して Microsoft Sentinel ワークスペースへ格納、格納されたログに対して Microsoft Sentinel が自動的に相関分析をかけていく、といった流れで処理を行うシステムを構築していきたいと思います。\nAzure Sentinel とのコネクタについては、今回は Microsoft Sentinel コミュニティで公開されている次のカスタムデータコネクタを利用していきます。\nhttps://github.com/Azure/Azure-Sentinel/tree/master/DataConnectors/GitHub\n本カスタムコネクタをデプロイすると、次の 3 種類の Azure Logic Apps リソースが動作するようになります。\n   リソース種別 説明     Audit Playbook 監査ログを定期的に収集する自動ワークフロー (デフォルト 5 分間隔)   Repo Playbook 各リポジトリに対するフォーク、クローン、コミットなどの操作ログを定期的に収集する自動ワークフロー (デフォルト 1 時間間隔)   Vulnerability Alert Playbook 各リポジトリに対するセキュリティ脆弱性診断ログを定期的に収集する自動ワークフロー (デフォルト 1 日間隔)    また、本カスタムコネクタで取得した各種ログデータについては、Log Analytics ワークスペースの次のカスタムテーブルへ格納されるようになります。\n   テーブル名 説明     GitHub_CL 監査ログのデータを格納するテーブル   GitHubRepoLogs_CL 各リポジトリに対するフォーク、クローン、コミットなどの操作ログやリポジトリに対するセキュリティ脆弱性診断ログのデータを格納するテーブル    それでは構築していきましょう 今回は GitHub Enterprise Cloud → Microsoft Sentinel ワークスペース → カスタムコネクタ → Microsoft Sentinel の順で設定していきます。\nGitHub Enterprise Cloud を設定しよう ここではログを収集する先の GitHub Organization の作成と、Azure Logic Apps から GitHub API へアクセスする際に利用するアクセストークンの作成を実施していきます。\nStep1. Organization(Enterprise)の作成 監査ログなどを取得する対象の Organization を作成しましょう。今回は GitHub Enterprise Cloud とするため課金プランは「Enterprise」を選択します。\nStep2. アクセストークンの作成 次に Azure Logic Apps から GitHub API へアクセスする際に利用するアクセストークンを作成します。Organization の Owner 権限を持つユーザで、Settings  Developer settings  Personal access tokens  Generate new tokens から作成しましょう。\n付与するスコープについては Microsoft Sentinel コミュニティでは言及されておりませんが、筆者の環境では必要最低限のスコープとして次の 5 つの権限を付与することで動作を確認することができました。\n public_repo admin:org read:user user:email admin:enterprise  作成後はデータコネクタをデプロイする際に利用するためトークン情報をコピーしておきます。\n注意: トークン情報が漏れると大変なことになりますので絶対に漏らさないように注意しましょう。\nMicrosoft Sentinel ワークスペースを設定しよう 次に Microsoft Sentinel の設定です。ここでは Microsoft Sentinel 用の Log Analytics ワークスペースの作成および Microsoft Sentinel リソースの作成を実施していきます。\nStep1. ワークスペースの作成 Azure ポータルなどから Microsoft Sentinel および Microsoft Sentinel 用の Log Analytics ワークスペースを作成しましょう。\nStep2. ワークスペース情報の取得 Microsoft Sentinel リソースの作成後は、データコネクタをデプロイする際に利用するため Log Analytics ワークスペース画面のエージェント管理などから「ワークスペース ID」と「主キー」をコピーしておきます。\nカスタムコネクタを設定しよう ここでは GitHub 用カスタムデータコネクタを Azure Resource Manager(ARM) テンプレートからデプロイして、対象 GitHub Organization からログデータを取得できるようにデータコネクタの諸設定まで実施していきます。\nStep1. ARM テンプレートのデプロイ それでは GitHub 用カスタムデータコネクタをデプロイしていきましょう。データコネクタの「Readme」に記載されている Deploy to Azureボタンをクリックします。\nAzure のカスタムテンプレートのデプロイ画面へ遷移したらパラメータ値を入力して作成をしましょう。\n   パラメータ 説明     Personal Access Token GitHub のアクセストークンを指定する   User Name GitHub アクセストークンなどを格納する Azure Key Vault キーコンテナへのアクセスを許可する Azure AD ユーザ名を指定する   Principal Id 上記 Azure AD ユーザのオブジェクト ID を指定する   Workspace Id Microsoft Sentinel ワークスペースのワークスペース ID を指定する   Workspace Key Microsoft Sentinel ワークスペースの主キーを指定する    デプロイにかかる時間は環境により誤差はあると思いますがおおよそ 2 分でした。デプロイが終わると Azure Logic Apps 以外にもストレージアカウントや Azure Key Vault などのリソースも作成されていることがわかります。\nStep2. Azure Key Vault API 接続の設定 Azure Logic Apps から Azure Key Vault キーコンテナに格納された GitHub アクセストークンへのアクセスを可能とするため、keyvault-GitHubPlaybooks リソースの設定画面から API 接続への承認処理を行います。\nStep3. 設定ファイルの作成 データコネクタの 2 種類の設定ファイル ORGS.json と lastrun-Audit.json を作成します。各ファイルの概要およびフォーマットは次の通りです。\n   ファイル名 説明     ORGS.json ログ取得対象の GitHub Organization を定義するファイル   lastrun-Audit.json 最終実行時刻を管理するファイル(新しいレコードのみを収集するために利用される)    ORGS.json [  {​​​​​​​  \"org\": \"\"  }​​​​​​​,  {​​​​​​​​​​​​​​​​​​​​​  \"org\": \"\"  }​​​​​​​​​​​​​​​​​​​​​,  {​​​​​​​​​​​​​​​​​​​​​  \"org\": \"\"  }​​​​​​​​​​​​​​​​​​​​​ ]  lastrun-Audit.json {​​​​​​​​​​​​​​​​​​​​​  \"lastContext\": \"\",  \"lastRun\": \"\" }​​​​​​​​​​​​​​​​​​​​​  ORGS.json ファイルを編集し、org パラメータ値をログ取得対象の GitHub Organization アカウント名に置きかえます。フォーマットのように、複数の GitHub Organization を指定することもできますので、実際の GitHub Organization の数にあわせて増減させてください。\nlastrun-Audit.json ファイルの各パラメータ値については、カスタムコネクタが動作すると自動的に値が更新されるためユーザ側で意識する必要はありません。\nStep4. 設定ファイルの配置 2 種類のファイルを作成したら、ARM テンプレートから作成されたストレージアカウントの githublogicapp コンテナにアップロードしましょう。\nStep5. Azure Blob Storage API 接続の設定 Azure Logic Apps からストレージアカウントに設定ファイルへのアクセスを可能とするため、ストレージアカウントのアクセスキー情報を取得し、azureblob-GitHubPlaybooks リソースの設定画面から API 接続を行います。\nStep6. Azure Logic Apps の有効化 最後に ARM テンプレートで作成された 3 つの Azure Logic Apps を有効化していきましょう。\nここまでで一通りの設定は終わりましたので、あとはスケジュールに沿ってログの取得が行われるようになっていることを確認していきましょう。\nStep7. 動作確認 まずは Azure Logic Apps から見ていきましょう。Azure Logic Apps では各アプリケーションが正しくスケジュール実行されていること、実行されたアプリケーションが正常終了していることを確認します。出力例のように実行の履歴にて成功と記録されていることが確認できれば OK です。\n次に Log Analytics ワークスペースを確認していきます。ここではカスタムログに GitHub Enterprise Cloud から取得したログが格納されていることを確認します。出力例のように「GitHub_CL」と「GitHubRepoLogs_CL」の 2 種類のカスタムテーブルが作成されていれば OK です。\n最後に Microsoft Sentinel を確認してみましょう。出力例のように「GitHub_CL」および「GitHubRepoLogs_CL」からのイベントが記録されていれば OK です。\n以上でカスタムコネクタのデプロイは終わりです。お疲れ様でした。\nMicrosoft Sentinel を設定しよう さてログデータが収集できるようになりましたので、ここからは収集したログデータを自動で分析して脅威を検出できるように Microsoft Sentinel の設定をしていきましょう。今回は Microsoft Sentinel が標準で用意している GitHub 固有の分析ルールを有効化し、次のイベントを自動で検出できるようにしていきたいと思います。\n GitHub アカウントへのブルートフォース攻撃 (※1) 複数の異なるロケーションからのサインインバースト (※1) 新しい国からのアクティビティ TI インジケータに登録した IP アドレスからのアクセス (※2) 二要素認証の無効化 リポジトリ内にセキュリティ脆弱性  ※1: Azure Active Directory(Azure AD) とのシングルサインオン(SSO)設定、Azure AD ログの収集が必要\n※2: Microsoft Sentinel の脅威インテリジェンス設定にて TI インジケータの事前登録が必要\nStep1. データの解析および正規化 まずは GitHub_CL テーブルおよび GitHubRepoLogs_CL テーブルに格納されているデータを、Microsoft Sentinel で分析しやすいように加工をしていきます。なお、Microsoft Sentinel コミュニティにてデータ加工用のパーサ関数(GitHubAudit 関数、GitHubRepo 関数)が公開されておりますので、今回はこちらを利用していきます。\nhttps://github.com/Azure/Azure-Sentinel/tree/master/Parsers/GitHub\nGitHubAudit関数 GitHub_CL | project TimeGenerated=node_createdAt_t,  Organization=columnifexists('node_organizationName_s', \"\"),  Action=node_action_s,  OperationType=node_operationType_s,  Repository=columnifexists('node_repositoryName_s',\"\"),  Actor=columnifexists('node_actorLogin_s', \"\"),  IPaddress=columnifexists('node_actorIp_s', \"\"),  City=columnifexists('node_actorLocation_city_s', \"\"),  Country=columnifexists('node_actorLocation_country_s', \"\"),  ImpactedUser=columnifexists('node_userLogin_s', \"\"),  ImpactedUserEmail=columnifexists('node_user_email_s', \"\"),  InvitedUserPermission=columnifexists('node_permission_s', \"\"),  Visibility=columnifexists('node_visibility_s', \"\"),  OauthApplication=columnifexists('node_oauthApplicationName_s', \"\"),  OauthApplicationUrl=columnifexists('node_applicationUrl_s', \"\"),  OauthApplicationState=columnifexists('node_state_s', \"\"),  UserCanInviteCollaborators=columnifexists('node_canInviteOutsideCollaboratorsToRepositories_b', \"\"),  MembershipType=columnifexists('node_membershipTypes_s', \"\"),  CurrentPermission=columnifexists('node_permission_s', \"\"),  PreviousPermission=columnifexists('node_permissionWas_s', \"\"),  TeamName=columnifexists('node_teamName_s', \"\"),  Reason=columnifexists('node_reason_s', \"\"),  BlockedUser=columnifexists('node_blockedUserName_s', \"\"),  CanCreateRepositories=columnifexists('canCreateRepositories_b', \"\")  GitHubRepo関数 GitHubRepoLogs_CL | project TimeGenerated = columnifexists('DateTime_t', \"\"),  Organization=columnifexists('Organization_s', \"\"),  Repository=columnifexists('Repository_s',\"\"),  Action=columnifexists('LogType_s',\"\"),  Actor=coalesce(login_s, owner_login_s),  ActorType=coalesce(owner_type_s, type_s),  IsPrivate=columnifexists('private_b',\"\"),  ForksUrl=columnifexists('forks_url_s',\"\"),  PushedAt=columnifexists('pushed_at_t',\"\"),  IsDisabled=columnifexists('disabled_b',\"\"),  AdminPermissions=columnifexists('permissions_admin_b',\"\"),  PushPermissions=columnifexists('permissions_push_b',\"\"),  PullPermissions=columnifexists('permissions_pull_b',\"\"),  ForkCount=columnifexists('forks_count_d',\"\"),  Count=columnifexists('count_d,',\"\"),  UniqueUsersCount=columnifexists('uniques_d',\"\"),  DismmisedAt=columnifexists('dismissedAt_t',\"\"),  Reason=columnifexists('dismissReason_s',\"\"),  vulnerableManifestFilename = columnifexists('vulnerableManifestFilename_s',\"\"),  Description=columnifexists('securityAdvisory_description_s',\"\"),  Link=columnifexists('securityAdvisory_permalink_s',\"\"),  PublishedAt=columnifexists('securityAdvisory_publishedAt_t ',\"\"),  Severity=columnifexists('securityAdvisory_severity_s',\"\"),  Summary=columnifexists('securityAdvisory_summary_s',\"\")  次の画像を参考に Microsoft Sentinel のログ画面から 2 つのパーサ関数を登録しましょう。なお、「従来のカテゴリ」の値については任意の文字列で大丈夫です。\nStep2. 分析ルールの追加 次に GitHub 固有の脅威を検出できるように分析ルールをテンプレートから追加していきしょう。Microsoft Sentinel では GitHub 固有の脅威に対する分析ルールのテンプレートが用意されていますので、今回はこちらを活用して分析ルールの追加をしてきたいと思います。出力例のように検索キーワードに「github」と入力することで目的のテンプレートを見つけることができます。\nなお、2021 年 11 月時点で用意されているテンプレートは次の 6 種類となります。\n   No. テンプレート名 説明     1 GitHub Two Factor Auth Disable 二要素認証の無効化イベントを検知するルール、デフォルトでは 1 日ごとにクエリを実行   2 GitHub Activites from a New Country 新しい国からのアクティビティを検知するルール、デフォルトでは過去 7 日分を学習データに利用して 1 日ごとにクエリを実行   3 Brute Force Attack against GitHub Account GitHub アカウントへのブルートフォース攻撃を検知するルール、デフォルトでは 1 日ごとにクエリを実行   4 GitHub Signin Burst from Multiple Locations 複数の異なるロケーションからのサインインバーストを検知するルール、デフォルトでは 1 時間ごとにクエリを実行   5 TI map IP entity to GitHub_CL TI インジケータに登録した IP アドレスからのアクセスを検知するルール、デフォルトでは 1 時間ごとにクエリを実行   6 GitHub Security Vulnerability in Repository リポジトリ内にセキュリティ脆弱性が含まれていることを検知するルール、デフォルトでは 1 時間ごとにクエリを実行    それではテンプレートを用いた分析ルールの追加をしていきましょう。まず追加したいルールを選択し、「ルールの作成」ボタンをクリックします。\nルールの追加画面ではウィザードに従ってルールの作成を行っていきます。各パラメータにはテンプレートによってデフォルト値が入力されていますので特に値を変更する要件がなければそのまま作成していきます。\n分析ルールが追加されたテンプレートについては次の出力例のように「使用中」アイコンが付与されます。先ほどと同様の手順を繰り返し、他のテンプレートに対しても分析ルールの追加をしていきましょう。出力例のように 6 種類すべてに使用中アイコンが付与されれば脅威を自動検知するルールの設定も終わりです。お疲れ様でした。\n補足、もう一歩踏み込んだ脅威分析を行うには Microsoft Sentinel では今回紹介した標準の分析ルールを利用する以外に、カスタム分析ルールを自作してより高度なイベントの検知をすることが可能です。サンプルとして次のようなカスタム分析ルールが Microsoft 技術ブログでも紹介されていますのでぜひ参考にしてみてください。\n リポジトリに対する異常数のクローン操作 リポジトリの一括削除 リポジトリをプライベートからパブリックに変更 リポジトリに対する部外者からのフォーク操作 GitHub Organization へのユーザ招待およびユーザ追加 ユーザへのアクセス許可の追加付与　など  https://techcommunity.microsoft.com/t5/microsoft-sentinel-blog/protecting-your-github-assets-with-azure-sentinel/ba-p/1457721\n終わりに 今回は GitHub Enterprise Cloud の各種ログを SIEM マネージドサービスである Microsoft Sentinel (旧称 Azure Sentinel) に集約し、サイバー攻撃の兆候を検知できるようにする方法のご紹介でしたがいかがだったでしょうか？\nGitHub Enterprise Cloud に限らず様々な監査ログを収集し、長期保存されている方は多いと思います。ただ、せっかく取得するのであればただ集めて長期保存しておくだけではなく、Microsoft Sentinel を活用してもう一歩進んだセキュアな環境を実現してみる、というのも “有り” なのではないでしょうか。\n以上、「Microsoft Sentinel を使って GitHub Enterprise Cloud のセキュリティを強化しよう (Azure Logic Apps 編)」でした。\n  Microsoft Azure は，Microsoft Corporation の商標または登録商標です。 GitHub は、GitHub Inc. の商標または登録商標です。 その他、本資料に記述してある会社名、製品名は、各社の登録商品または商標です。    SIEM(Security Information and Event Management) は、様々なログを一元的に集約、相関分析をしてサイバー攻撃などの異常を自動的に検出するソリューションです。 ↩︎\n   ","wordCount":"726","inLanguage":"en","datePublished":"2021-11-26T00:00:00Z","dateModified":"2021-11-26T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://chacco38.github.io/posts/2021/11/azure-sentinel-logicapps-data-connector-for-ghec/"},"publisher":{"@type":"Organization","name":"クラウドCoEの何でも屋","logo":{"@type":"ImageObject","url":"https://chacco38.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://chacco38.github.io/ accesskey=h title="クラウドCoEの何でも屋 (Alt + H)">クラウドCoEの何でも屋</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://chacco38.github.io/blog/ title=Blog><span>Blog</span></a></li><li><a href=https://chacco38.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://chacco38.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://chacco38.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://chacco38.github.io/posts/>Posts</a></div><h1 class=post-title>Microsoft Sentinel を使って GitHub Enterprise Cloud のセキュリティを強化しよう (Azure Logic Apps コネクタ編)</h1><div class=post-meta><span title="2021-11-26 00:00:00 +0000 UTC">November 26, 2021</span>&nbsp;·&nbsp;4 min&nbsp;|&nbsp;<a href=https://github.com/chacco38/chacco38.github.io/tree/main/content/posts/2021/11/azure-sentinel-logicapps-data-connector-for-ghec/index.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e3%81%af%e3%81%98%e3%82%81%e3%81%ab aria-label=はじめに>はじめに</a></li><li><a href=#%e6%a7%8b%e7%af%89%e3%81%99%e3%82%8b%e3%82%b7%e3%82%b9%e3%83%86%e3%83%a0%e3%81%ab%e3%81%a4%e3%81%84%e3%81%a6 aria-label=構築するシステムについて>構築するシステムについて</a></li><li><a href=#%e3%81%9d%e3%82%8c%e3%81%a7%e3%81%af%e6%a7%8b%e7%af%89%e3%81%97%e3%81%a6%e3%81%84%e3%81%8d%e3%81%be%e3%81%97%e3%82%87%e3%81%86 aria-label=それでは構築していきましょう>それでは構築していきましょう</a><ul><li><a href=#github-enterprise-cloud-%e3%82%92%e8%a8%ad%e5%ae%9a%e3%81%97%e3%82%88%e3%81%86 aria-label="GitHub Enterprise Cloud を設定しよう">GitHub Enterprise Cloud を設定しよう</a><ul><li><a href=#step1-organizationenterprise%e3%81%ae%e4%bd%9c%e6%88%90 aria-label="Step1. Organization(Enterprise)の作成">Step1. Organization(Enterprise)の作成</a></li><li><a href=#step2-%e3%82%a2%e3%82%af%e3%82%bb%e3%82%b9%e3%83%88%e3%83%bc%e3%82%af%e3%83%b3%e3%81%ae%e4%bd%9c%e6%88%90 aria-label="Step2. アクセストークンの作成">Step2. アクセストークンの作成</a></li></ul></li><li><a href=#microsoft-sentinel-%e3%83%af%e3%83%bc%e3%82%af%e3%82%b9%e3%83%9a%e3%83%bc%e3%82%b9%e3%82%92%e8%a8%ad%e5%ae%9a%e3%81%97%e3%82%88%e3%81%86 aria-label="Microsoft Sentinel ワークスペースを設定しよう">Microsoft Sentinel ワークスペースを設定しよう</a><ul><li><a href=#step1-%e3%83%af%e3%83%bc%e3%82%af%e3%82%b9%e3%83%9a%e3%83%bc%e3%82%b9%e3%81%ae%e4%bd%9c%e6%88%90 aria-label="Step1. ワークスペースの作成">Step1. ワークスペースの作成</a></li><li><a href=#step2-%e3%83%af%e3%83%bc%e3%82%af%e3%82%b9%e3%83%9a%e3%83%bc%e3%82%b9%e6%83%85%e5%a0%b1%e3%81%ae%e5%8f%96%e5%be%97 aria-label="Step2. ワークスペース情報の取得">Step2. ワークスペース情報の取得</a></li></ul></li><li><a href=#%e3%82%ab%e3%82%b9%e3%82%bf%e3%83%a0%e3%82%b3%e3%83%8d%e3%82%af%e3%82%bf%e3%82%92%e8%a8%ad%e5%ae%9a%e3%81%97%e3%82%88%e3%81%86 aria-label=カスタムコネクタを設定しよう>カスタムコネクタを設定しよう</a><ul><li><a href=#step1-arm-%e3%83%86%e3%83%b3%e3%83%97%e3%83%ac%e3%83%bc%e3%83%88%e3%81%ae%e3%83%87%e3%83%97%e3%83%ad%e3%82%a4 aria-label="Step1. ARM テンプレートのデプロイ">Step1. ARM テンプレートのデプロイ</a></li><li><a href=#step2-azure-key-vault-api-%e6%8e%a5%e7%b6%9a%e3%81%ae%e8%a8%ad%e5%ae%9a aria-label="Step2. Azure Key Vault API 接続の設定">Step2. Azure Key Vault API 接続の設定</a></li><li><a href=#step3-%e8%a8%ad%e5%ae%9a%e3%83%95%e3%82%a1%e3%82%a4%e3%83%ab%e3%81%ae%e4%bd%9c%e6%88%90 aria-label="Step3. 設定ファイルの作成">Step3. 設定ファイルの作成</a></li><li><a href=#step4-%e8%a8%ad%e5%ae%9a%e3%83%95%e3%82%a1%e3%82%a4%e3%83%ab%e3%81%ae%e9%85%8d%e7%bd%ae aria-label="Step4. 設定ファイルの配置">Step4. 設定ファイルの配置</a></li><li><a href=#step5-azure-blob-storage-api-%e6%8e%a5%e7%b6%9a%e3%81%ae%e8%a8%ad%e5%ae%9a aria-label="Step5. Azure Blob Storage API 接続の設定">Step5. Azure Blob Storage API 接続の設定</a></li><li><a href=#step6-azure-logic-apps-%e3%81%ae%e6%9c%89%e5%8a%b9%e5%8c%96 aria-label="Step6. Azure Logic Apps の有効化">Step6. Azure Logic Apps の有効化</a></li><li><a href=#step7-%e5%8b%95%e4%bd%9c%e7%a2%ba%e8%aa%8d aria-label="Step7. 動作確認">Step7. 動作確認</a></li></ul></li><li><a href=#microsoft-sentinel-%e3%82%92%e8%a8%ad%e5%ae%9a%e3%81%97%e3%82%88%e3%81%86 aria-label="Microsoft Sentinel を設定しよう">Microsoft Sentinel を設定しよう</a><ul><li><a href=#step1-%e3%83%87%e3%83%bc%e3%82%bf%e3%81%ae%e8%a7%a3%e6%9e%90%e3%81%8a%e3%82%88%e3%81%b3%e6%ad%a3%e8%a6%8f%e5%8c%96 aria-label="Step1. データの解析および正規化">Step1. データの解析および正規化</a></li><li><a href=#step2-%e5%88%86%e6%9e%90%e3%83%ab%e3%83%bc%e3%83%ab%e3%81%ae%e8%bf%bd%e5%8a%a0 aria-label="Step2. 分析ルールの追加">Step2. 分析ルールの追加</a></li></ul></li><li><a href=#%e8%a3%9c%e8%b6%b3%e3%82%82%e3%81%86%e4%b8%80%e6%ad%a9%e8%b8%8f%e3%81%bf%e8%be%bc%e3%82%93%e3%81%a0%e8%84%85%e5%a8%81%e5%88%86%e6%9e%90%e3%82%92%e8%a1%8c%e3%81%86%e3%81%ab%e3%81%af aria-label=補足、もう一歩踏み込んだ脅威分析を行うには>補足、もう一歩踏み込んだ脅威分析を行うには</a></li></ul></li><li><a href=#%e7%b5%82%e3%82%8f%e3%82%8a%e3%81%ab aria-label=終わりに>終わりに</a></li></ul></div></details></div><div class=post-content><h1 id=はじめに>はじめに<a hidden class=anchor aria-hidden=true href=#はじめに>#</a></h1><p>みなさん、こんにちは。今回は GitHub Enterprise Cloud(GHEC) の各種ログを SIEM<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> マネージドサービスである Microsoft Sentinel (旧称 Azure Sentinel) に集約し、サイバー攻撃の兆候を検知できるようにする方法をご紹介していきたいと思います。</p><p>Microsoft Sentinel と GHEC との連携方法はいくつかあるのですが、この記事では Microsoft Sentinel コミュニティで開発している Azure Logic Apps(ロジックアプリ)、Azure Functions(関数アプリ)の 2 種類のカスタムデータコネクタの内、「Azure Logic Apps コネクタ」を使った方法をご紹介していきたいと思います。</p><p>これから GHEC の利用を検討している方や、GHEC は利用しているけれど SIEM システムの導入まではしていないという方は、セキュリティ強化策のひとつとして参考にしてみてはいかがでしょうか。</p><h1 id=構築するシステムについて>構築するシステムについて<a hidden class=anchor aria-hidden=true href=#構築するシステムについて>#</a></h1><p>今回は Azure Logic Apps(ロジックアプリ)を定期的に起動し、GHEC から監査ログなどを取得して Microsoft Sentinel ワークスペースへ格納、格納されたログに対して Microsoft Sentinel が自動的に相関分析をかけていく、といった流れで処理を行うシステムを構築していきたいと思います。</p><p><img loading=lazy src=images/01-overview.drawio.png alt=01-overview.drawio.png></p><p>Azure Sentinel とのコネクタについては、今回は Microsoft Sentinel コミュニティで公開されている次のカスタムデータコネクタを利用していきます。</p><p><a href=https://github.com/Azure/Azure-Sentinel/tree/master/DataConnectors/GitHub>https://github.com/Azure/Azure-Sentinel/tree/master/DataConnectors/GitHub</a></p><p>本カスタムコネクタをデプロイすると、次の 3 種類の Azure Logic Apps リソースが動作するようになります。</p><table><thead><tr><th>リソース種別</th><th>説明</th></tr></thead><tbody><tr><td>Audit Playbook</td><td>監査ログを定期的に収集する自動ワークフロー (デフォルト 5 分間隔)</td></tr><tr><td>Repo Playbook</td><td>各リポジトリに対するフォーク、クローン、コミットなどの操作ログを定期的に収集する自動ワークフロー (デフォルト 1 時間間隔)</td></tr><tr><td>Vulnerability Alert Playbook</td><td>各リポジトリに対するセキュリティ脆弱性診断ログを定期的に収集する自動ワークフロー (デフォルト 1 日間隔)</td></tr></tbody></table><p>また、本カスタムコネクタで取得した各種ログデータについては、Log Analytics ワークスペースの次のカスタムテーブルへ格納されるようになります。</p><table><thead><tr><th>テーブル名</th><th>説明</th></tr></thead><tbody><tr><td>GitHub_CL</td><td>監査ログのデータを格納するテーブル</td></tr><tr><td>GitHubRepoLogs_CL</td><td>各リポジトリに対するフォーク、クローン、コミットなどの操作ログやリポジトリに対するセキュリティ脆弱性診断ログのデータを格納するテーブル</td></tr></tbody></table><h1 id=それでは構築していきましょう>それでは構築していきましょう<a hidden class=anchor aria-hidden=true href=#それでは構築していきましょう>#</a></h1><p>今回は GitHub Enterprise Cloud → Microsoft Sentinel ワークスペース → カスタムコネクタ → Microsoft Sentinel の順で設定していきます。</p><h2 id=github-enterprise-cloud-を設定しよう>GitHub Enterprise Cloud を設定しよう<a hidden class=anchor aria-hidden=true href=#github-enterprise-cloud-を設定しよう>#</a></h2><p>ここではログを収集する先の GitHub Organization の作成と、Azure Logic Apps から GitHub API へアクセスする際に利用するアクセストークンの作成を実施していきます。</p><h3 id=step1-organizationenterpriseの作成>Step1. Organization(Enterprise)の作成<a hidden class=anchor aria-hidden=true href=#step1-organizationenterpriseの作成>#</a></h3><p>監査ログなどを取得する対象の Organization を作成しましょう。今回は GitHub Enterprise Cloud とするため課金プランは「Enterprise」を選択します。</p><p><img loading=lazy src=images/02-create-github-organization.png alt=02-create-github-organization.png></p><h3 id=step2-アクセストークンの作成>Step2. アクセストークンの作成<a hidden class=anchor aria-hidden=true href=#step2-アクセストークンの作成>#</a></h3><p>次に Azure Logic Apps から GitHub API へアクセスする際に利用するアクセストークンを作成します。Organization の Owner 権限を持つユーザで、Settings > Developer settings > Personal access tokens > Generate new tokens から作成しましょう。</p><p>付与するスコープについては Microsoft Sentinel コミュニティでは言及されておりませんが、筆者の環境では必要最低限のスコープとして次の 5 つの権限を付与することで動作を確認することができました。</p><ul><li>public_repo</li><li>admin:org</li><li>read:user</li><li>user:email</li><li>admin:enterprise</li></ul><p>作成後はデータコネクタをデプロイする際に利用するためトークン情報をコピーしておきます。</p><p><img loading=lazy src=images/03-create-github-pat.png alt=03-create-github-pat.png></p><p><strong>注意: トークン情報が漏れると大変なことになりますので絶対に漏らさないように注意しましょう。</strong></p><h2 id=microsoft-sentinel-ワークスペースを設定しよう>Microsoft Sentinel ワークスペースを設定しよう<a hidden class=anchor aria-hidden=true href=#microsoft-sentinel-ワークスペースを設定しよう>#</a></h2><p>次に Microsoft Sentinel の設定です。ここでは Microsoft Sentinel 用の Log Analytics ワークスペースの作成および Microsoft Sentinel リソースの作成を実施していきます。</p><h3 id=step1-ワークスペースの作成>Step1. ワークスペースの作成<a hidden class=anchor aria-hidden=true href=#step1-ワークスペースの作成>#</a></h3><p>Azure ポータルなどから Microsoft Sentinel および Microsoft Sentinel 用の Log Analytics ワークスペースを作成しましょう。</p><p><img loading=lazy src=images/04-create-azure-sentinel.png alt=04-create-azure-sentinel.png></p><h3 id=step2-ワークスペース情報の取得>Step2. ワークスペース情報の取得<a hidden class=anchor aria-hidden=true href=#step2-ワークスペース情報の取得>#</a></h3><p>Microsoft Sentinel リソースの作成後は、データコネクタをデプロイする際に利用するため Log Analytics ワークスペース画面のエージェント管理などから「ワークスペース ID」と「主キー」をコピーしておきます。</p><p><img loading=lazy src=images/05-sentinel-workspace.png alt=05-sentinel-workspace.png></p><h2 id=カスタムコネクタを設定しよう>カスタムコネクタを設定しよう<a hidden class=anchor aria-hidden=true href=#カスタムコネクタを設定しよう>#</a></h2><p>ここでは GitHub 用カスタムデータコネクタを Azure Resource Manager(ARM) テンプレートからデプロイして、対象 GitHub Organization からログデータを取得できるようにデータコネクタの諸設定まで実施していきます。</p><h3 id=step1-arm-テンプレートのデプロイ>Step1. ARM テンプレートのデプロイ<a hidden class=anchor aria-hidden=true href=#step1-arm-テンプレートのデプロイ>#</a></h3><p>それでは GitHub 用カスタムデータコネクタをデプロイしていきましょう。データコネクタの「<a href=https://github.com/Azure/Azure-Sentinel/tree/master/DataConnectors/GitHub#deploy-the-logic-app-template>Readme</a>」に記載されている <code>Deploy to Azure</code>ボタンをクリックします。</p><p><img loading=lazy src=images/06-deploy-template.png alt=06-deploy-template.png></p><p>Azure のカスタムテンプレートのデプロイ画面へ遷移したらパラメータ値を入力して作成をしましょう。</p><table><thead><tr><th>パラメータ</th><th>説明</th></tr></thead><tbody><tr><td>Personal Access Token</td><td>GitHub のアクセストークンを指定する</td></tr><tr><td>User Name</td><td>GitHub アクセストークンなどを格納する Azure Key Vault キーコンテナへのアクセスを許可する Azure AD ユーザ名を指定する</td></tr><tr><td>Principal Id</td><td>上記 Azure AD ユーザのオブジェクト ID を指定する</td></tr><tr><td>Workspace Id</td><td>Microsoft Sentinel ワークスペースのワークスペース ID を指定する</td></tr><tr><td>Workspace Key</td><td>Microsoft Sentinel ワークスペースの主キーを指定する</td></tr></tbody></table><p><img loading=lazy src=images/07-deploy-custom-template.png alt=07-deploy-custom-template.png></p><p>デプロイにかかる時間は環境により誤差はあると思いますがおおよそ 2 分でした。デプロイが終わると Azure Logic Apps 以外にもストレージアカウントや Azure Key Vault などのリソースも作成されていることがわかります。</p><p><img loading=lazy src=images/08-resource-list.png alt=08-resource-list.png></p><h3 id=step2-azure-key-vault-api-接続の設定>Step2. Azure Key Vault API 接続の設定<a hidden class=anchor aria-hidden=true href=#step2-azure-key-vault-api-接続の設定>#</a></h3><p>Azure Logic Apps から Azure Key Vault キーコンテナに格納された GitHub アクセストークンへのアクセスを可能とするため、keyvault-GitHubPlaybooks リソースの設定画面から API 接続への承認処理を行います。</p><p><img loading=lazy src=images/09-authorize-api-connection.png alt=09-authorize-api-connection.png></p><h3 id=step3-設定ファイルの作成>Step3. 設定ファイルの作成<a hidden class=anchor aria-hidden=true href=#step3-設定ファイルの作成>#</a></h3><p>データコネクタの 2 種類の設定ファイル ORGS.json と lastrun-Audit.json を作成します。各ファイルの概要およびフォーマットは次の通りです。</p><table><thead><tr><th>ファイル名</th><th>説明</th></tr></thead><tbody><tr><td>ORGS.json</td><td>ログ取得対象の GitHub Organization を定義するファイル</td></tr><tr><td>lastrun-Audit.json</td><td>最終実行時刻を管理するファイル(新しいレコードのみを収集するために利用される)</td></tr></tbody></table><figure class=xCodeBlock><figcaption class=xCodeBlock_title>ORGS.json</figcaption><div class=xCodeBlock_code><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>[
</span></span><span style=display:flex><span>    {<span style=color:#960050;background-color:#1e0010>​​​​​​​</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;org&#34;</span>: <span style=color:#e6db74>&#34;&lt;Your 1st organization account name&gt;&#34;</span>
</span></span><span style=display:flex><span>    }<span style=color:#960050;background-color:#1e0010>​​​​​​​</span>,
</span></span><span style=display:flex><span>    {<span style=color:#960050;background-color:#1e0010>​​​​​​​​​​​​​​​​​​​​​</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;org&#34;</span>: <span style=color:#e6db74>&#34;&lt;Your 2nd organization account name&gt;&#34;</span>
</span></span><span style=display:flex><span>    }<span style=color:#960050;background-color:#1e0010>​​​​​​​​​​​​​​​​​​​​​</span>,
</span></span><span style=display:flex><span>    {<span style=color:#960050;background-color:#1e0010>​​​​​​​​​​​​​​​​​​​​​</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;org&#34;</span>: <span style=color:#e6db74>&#34;&lt;Your Nth organization account name&gt;&#34;</span>
</span></span><span style=display:flex><span>    }<span style=color:#960050;background-color:#1e0010>​​​​​​​​​​​​​​​​​​​​​</span>
</span></span><span style=display:flex><span>]</span></span></code></pre></div></div></figure><figure class=xCodeBlock><figcaption class=xCodeBlock_title>lastrun-Audit.json</figcaption><div class=xCodeBlock_code><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{<span style=color:#960050;background-color:#1e0010>​​​​​​​​​​​​​​​​​​​​​</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;lastContext&#34;</span>: <span style=color:#e6db74>&#34;&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;lastRun&#34;</span>: <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>}<span style=color:#960050;background-color:#1e0010>​​​​​​​​​​​​​​​​​​​​​</span></span></span></code></pre></div></div></figure><p>ORGS.json ファイルを編集し、org パラメータ値をログ取得対象の GitHub Organization アカウント名に置きかえます。フォーマットのように、複数の GitHub Organization を指定することもできますので、実際の GitHub Organization の数にあわせて増減させてください。</p><p>lastrun-Audit.json ファイルの各パラメータ値については、カスタムコネクタが動作すると自動的に値が更新されるためユーザ側で意識する必要はありません。</p><h3 id=step4-設定ファイルの配置>Step4. 設定ファイルの配置<a hidden class=anchor aria-hidden=true href=#step4-設定ファイルの配置>#</a></h3><p>2 種類のファイルを作成したら、ARM テンプレートから作成されたストレージアカウントの githublogicapp コンテナにアップロードしましょう。</p><p><img loading=lazy src=images/10-upload-connector-settings.png alt=10-upload-connector-settings.png></p><h3 id=step5-azure-blob-storage-api-接続の設定>Step5. Azure Blob Storage API 接続の設定<a hidden class=anchor aria-hidden=true href=#step5-azure-blob-storage-api-接続の設定>#</a></h3><p>Azure Logic Apps からストレージアカウントに設定ファイルへのアクセスを可能とするため、ストレージアカウントのアクセスキー情報を取得し、azureblob-GitHubPlaybooks リソースの設定画面から API 接続を行います。</p><p><img loading=lazy src=images/11-config-blob-api-connection.png alt=11-config-blob-api-connection.png></p><h3 id=step6-azure-logic-apps-の有効化>Step6. Azure Logic Apps の有効化<a hidden class=anchor aria-hidden=true href=#step6-azure-logic-apps-の有効化>#</a></h3><p>最後に ARM テンプレートで作成された 3 つの Azure Logic Apps を有効化していきましょう。</p><p><img loading=lazy src=images/12-enable-logic-apps.png alt=12-enable-logic-apps.png></p><p>ここまでで一通りの設定は終わりましたので、あとはスケジュールに沿ってログの取得が行われるようになっていることを確認していきましょう。</p><h3 id=step7-動作確認>Step7. 動作確認<a hidden class=anchor aria-hidden=true href=#step7-動作確認>#</a></h3><p>まずは Azure Logic Apps から見ていきましょう。Azure Logic Apps では各アプリケーションが正しくスケジュール実行されていること、実行されたアプリケーションが正常終了していることを確認します。出力例のように実行の履歴にて成功と記録されていることが確認できれば OK です。</p><p><img loading=lazy src=images/13-logic-app-history.png alt=13-logic-app-history.png></p><p>次に Log Analytics ワークスペースを確認していきます。ここではカスタムログに GitHub Enterprise Cloud から取得したログが格納されていることを確認します。出力例のように「GitHub_CL」と「GitHubRepoLogs_CL」の 2 種類のカスタムテーブルが作成されていれば OK です。</p><p><img loading=lazy src=images/14-check-custom-logs.png alt=14-check-custom-logs.png></p><p>最後に Microsoft Sentinel を確認してみましょう。出力例のように「GitHub_CL」および「GitHubRepoLogs_CL」からのイベントが記録されていれば OK です。</p><p><img loading=lazy src=images/15-sentinel.png alt=15-sentinel.png></p><p>以上でカスタムコネクタのデプロイは終わりです。お疲れ様でした。</p><h2 id=microsoft-sentinel-を設定しよう>Microsoft Sentinel を設定しよう<a hidden class=anchor aria-hidden=true href=#microsoft-sentinel-を設定しよう>#</a></h2><p>さてログデータが収集できるようになりましたので、ここからは収集したログデータを自動で分析して脅威を検出できるように Microsoft Sentinel の設定をしていきましょう。今回は Microsoft Sentinel が標準で用意している GitHub 固有の分析ルールを有効化し、次のイベントを自動で検出できるようにしていきたいと思います。</p><ul><li>GitHub アカウントへのブルートフォース攻撃 (※1)</li><li>複数の異なるロケーションからのサインインバースト (※1)</li><li>新しい国からのアクティビティ</li><li>TI インジケータに登録した IP アドレスからのアクセス (※2)</li><li>二要素認証の無効化</li><li>リポジトリ内にセキュリティ脆弱性</li></ul><p>※1: Azure Active Directory(Azure AD) とのシングルサインオン(SSO)設定、Azure AD ログの収集が必要</p><p>※2: Microsoft Sentinel の脅威インテリジェンス設定にて TI インジケータの事前登録が必要</p><h3 id=step1-データの解析および正規化>Step1. データの解析および正規化<a hidden class=anchor aria-hidden=true href=#step1-データの解析および正規化>#</a></h3><p>まずは GitHub_CL テーブルおよび GitHubRepoLogs_CL テーブルに格納されているデータを、Microsoft Sentinel で分析しやすいように加工をしていきます。なお、Microsoft Sentinel コミュニティにてデータ加工用のパーサ関数(GitHubAudit 関数、GitHubRepo 関数)が公開されておりますので、今回はこちらを利用していきます。</p><p><a href=https://github.com/Azure/Azure-Sentinel/tree/master/Parsers/GitHub>https://github.com/Azure/Azure-Sentinel/tree/master/Parsers/GitHub</a></p><figure class=xCodeBlock><figcaption class=xCodeBlock_title>GitHubAudit関数</figcaption><div class=xCodeBlock_code><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>GitHub_CL
</span></span><span style=display:flex><span>| project TimeGenerated=node_createdAt_t,
</span></span><span style=display:flex><span>    Organization=columnifexists(&#39;node_organizationName_s&#39;, &#34;&#34;),
</span></span><span style=display:flex><span>    Action=node_action_s,
</span></span><span style=display:flex><span>    OperationType=node_operationType_s,
</span></span><span style=display:flex><span>    Repository=columnifexists(&#39;node_repositoryName_s&#39;,&#34;&#34;),
</span></span><span style=display:flex><span>    Actor=columnifexists(&#39;node_actorLogin_s&#39;, &#34;&#34;),
</span></span><span style=display:flex><span>    IPaddress=columnifexists(&#39;node_actorIp_s&#39;, &#34;&#34;),
</span></span><span style=display:flex><span>    City=columnifexists(&#39;node_actorLocation_city_s&#39;, &#34;&#34;),
</span></span><span style=display:flex><span>    Country=columnifexists(&#39;node_actorLocation_country_s&#39;, &#34;&#34;),
</span></span><span style=display:flex><span>    ImpactedUser=columnifexists(&#39;node_userLogin_s&#39;, &#34;&#34;),
</span></span><span style=display:flex><span>    ImpactedUserEmail=columnifexists(&#39;node_user_email_s&#39;, &#34;&#34;),
</span></span><span style=display:flex><span>    InvitedUserPermission=columnifexists(&#39;node_permission_s&#39;, &#34;&#34;),
</span></span><span style=display:flex><span>    Visibility=columnifexists(&#39;node_visibility_s&#39;, &#34;&#34;),
</span></span><span style=display:flex><span>    OauthApplication=columnifexists(&#39;node_oauthApplicationName_s&#39;, &#34;&#34;),
</span></span><span style=display:flex><span>    OauthApplicationUrl=columnifexists(&#39;node_applicationUrl_s&#39;, &#34;&#34;),
</span></span><span style=display:flex><span>    OauthApplicationState=columnifexists(&#39;node_state_s&#39;, &#34;&#34;),
</span></span><span style=display:flex><span>    UserCanInviteCollaborators=columnifexists(&#39;node_canInviteOutsideCollaboratorsToRepositories_b&#39;, &#34;&#34;),
</span></span><span style=display:flex><span>    MembershipType=columnifexists(&#39;node_membershipTypes_s&#39;, &#34;&#34;),
</span></span><span style=display:flex><span>    CurrentPermission=columnifexists(&#39;node_permission_s&#39;, &#34;&#34;),
</span></span><span style=display:flex><span>    PreviousPermission=columnifexists(&#39;node_permissionWas_s&#39;, &#34;&#34;),
</span></span><span style=display:flex><span>    TeamName=columnifexists(&#39;node_teamName_s&#39;, &#34;&#34;),
</span></span><span style=display:flex><span>    Reason=columnifexists(&#39;node_reason_s&#39;, &#34;&#34;),
</span></span><span style=display:flex><span>    BlockedUser=columnifexists(&#39;node_blockedUserName_s&#39;, &#34;&#34;),
</span></span><span style=display:flex><span>    CanCreateRepositories=columnifexists(&#39;canCreateRepositories_b&#39;, &#34;&#34;)</span></span></code></pre></div></div></figure><figure class=xCodeBlock><figcaption class=xCodeBlock_title>GitHubRepo関数</figcaption><div class=xCodeBlock_code><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>GitHubRepoLogs_CL
</span></span><span style=display:flex><span>| project TimeGenerated = columnifexists(&#39;DateTime_t&#39;, &#34;&#34;),
</span></span><span style=display:flex><span>    Organization=columnifexists(&#39;Organization_s&#39;, &#34;&#34;),
</span></span><span style=display:flex><span>    Repository=columnifexists(&#39;Repository_s&#39;,&#34;&#34;),
</span></span><span style=display:flex><span>    Action=columnifexists(&#39;LogType_s&#39;,&#34;&#34;),
</span></span><span style=display:flex><span>    Actor=coalesce(login_s, owner_login_s),
</span></span><span style=display:flex><span>    ActorType=coalesce(owner_type_s, type_s),
</span></span><span style=display:flex><span>    IsPrivate=columnifexists(&#39;private_b&#39;,&#34;&#34;),
</span></span><span style=display:flex><span>    ForksUrl=columnifexists(&#39;forks_url_s&#39;,&#34;&#34;),
</span></span><span style=display:flex><span>    PushedAt=columnifexists(&#39;pushed_at_t&#39;,&#34;&#34;),
</span></span><span style=display:flex><span>    IsDisabled=columnifexists(&#39;disabled_b&#39;,&#34;&#34;),
</span></span><span style=display:flex><span>    AdminPermissions=columnifexists(&#39;permissions_admin_b&#39;,&#34;&#34;),
</span></span><span style=display:flex><span>    PushPermissions=columnifexists(&#39;permissions_push_b&#39;,&#34;&#34;),
</span></span><span style=display:flex><span>    PullPermissions=columnifexists(&#39;permissions_pull_b&#39;,&#34;&#34;),
</span></span><span style=display:flex><span>    ForkCount=columnifexists(&#39;forks_count_d&#39;,&#34;&#34;),
</span></span><span style=display:flex><span>    Count=columnifexists(&#39;count_d,&#39;,&#34;&#34;),
</span></span><span style=display:flex><span>    UniqueUsersCount=columnifexists(&#39;uniques_d&#39;,&#34;&#34;),
</span></span><span style=display:flex><span>    DismmisedAt=columnifexists(&#39;dismissedAt_t&#39;,&#34;&#34;),
</span></span><span style=display:flex><span>    Reason=columnifexists(&#39;dismissReason_s&#39;,&#34;&#34;),
</span></span><span style=display:flex><span>    vulnerableManifestFilename = columnifexists(&#39;vulnerableManifestFilename_s&#39;,&#34;&#34;),
</span></span><span style=display:flex><span>    Description=columnifexists(&#39;securityAdvisory_description_s&#39;,&#34;&#34;),
</span></span><span style=display:flex><span>    Link=columnifexists(&#39;securityAdvisory_permalink_s&#39;,&#34;&#34;),
</span></span><span style=display:flex><span>    PublishedAt=columnifexists(&#39;securityAdvisory_publishedAt_t &#39;,&#34;&#34;),
</span></span><span style=display:flex><span>    Severity=columnifexists(&#39;securityAdvisory_severity_s&#39;,&#34;&#34;),
</span></span><span style=display:flex><span>    Summary=columnifexists(&#39;securityAdvisory_summary_s&#39;,&#34;&#34;)</span></span></code></pre></div></div></figure><p>次の画像を参考に Microsoft Sentinel のログ画面から 2 つのパーサ関数を登録しましょう。なお、「従来のカテゴリ」の値については任意の文字列で大丈夫です。</p><p><img loading=lazy src=images/16-create-parse-func.png alt=16-create-parse-func.png></p><h3 id=step2-分析ルールの追加>Step2. 分析ルールの追加<a hidden class=anchor aria-hidden=true href=#step2-分析ルールの追加>#</a></h3><p>次に GitHub 固有の脅威を検出できるように分析ルールをテンプレートから追加していきしょう。Microsoft Sentinel では GitHub 固有の脅威に対する分析ルールのテンプレートが用意されていますので、今回はこちらを活用して分析ルールの追加をしてきたいと思います。出力例のように検索キーワードに「github」と入力することで目的のテンプレートを見つけることができます。</p><p><img loading=lazy src=images/17-analytics-template.png alt=17-analytics-template.png></p><p>なお、2021 年 11 月時点で用意されているテンプレートは次の 6 種類となります。</p><table><thead><tr><th>No.</th><th>テンプレート名</th><th>説明</th></tr></thead><tbody><tr><td>1</td><td>GitHub Two Factor Auth Disable</td><td>二要素認証の無効化イベントを検知するルール、デフォルトでは 1 日ごとにクエリを実行</td></tr><tr><td>2</td><td>GitHub Activites from a New Country</td><td>新しい国からのアクティビティを検知するルール、デフォルトでは過去 7 日分を学習データに利用して 1 日ごとにクエリを実行</td></tr><tr><td>3</td><td>Brute Force Attack against GitHub Account</td><td>GitHub アカウントへのブルートフォース攻撃を検知するルール、デフォルトでは 1 日ごとにクエリを実行</td></tr><tr><td>4</td><td>GitHub Signin Burst from Multiple Locations</td><td>複数の異なるロケーションからのサインインバーストを検知するルール、デフォルトでは 1 時間ごとにクエリを実行</td></tr><tr><td>5</td><td>TI map IP entity to GitHub_CL</td><td>TI インジケータに登録した IP アドレスからのアクセスを検知するルール、デフォルトでは 1 時間ごとにクエリを実行</td></tr><tr><td>6</td><td>GitHub Security Vulnerability in Repository</td><td>リポジトリ内にセキュリティ脆弱性が含まれていることを検知するルール、デフォルトでは 1 時間ごとにクエリを実行</td></tr></tbody></table><p>それではテンプレートを用いた分析ルールの追加をしていきましょう。まず追加したいルールを選択し、「ルールの作成」ボタンをクリックします。</p><p><img loading=lazy src=images/18-select-template.png alt=18-select-template.png></p><p>ルールの追加画面ではウィザードに従ってルールの作成を行っていきます。各パラメータにはテンプレートによってデフォルト値が入力されていますので特に値を変更する要件がなければそのまま作成していきます。</p><p><img loading=lazy src=images/19-create-rule.png alt=19-create-rule.png></p><p>分析ルールが追加されたテンプレートについては次の出力例のように「使用中」アイコンが付与されます。先ほどと同様の手順を繰り返し、他のテンプレートに対しても分析ルールの追加をしていきましょう。出力例のように 6 種類すべてに使用中アイコンが付与されれば脅威を自動検知するルールの設定も終わりです。お疲れ様でした。</p><p><img loading=lazy src=images/20-analytics-template.png alt=20-analytics-template.png></p><h2 id=補足もう一歩踏み込んだ脅威分析を行うには>補足、もう一歩踏み込んだ脅威分析を行うには<a hidden class=anchor aria-hidden=true href=#補足もう一歩踏み込んだ脅威分析を行うには>#</a></h2><p>Microsoft Sentinel では今回紹介した標準の分析ルールを利用する以外に、カスタム分析ルールを自作してより高度なイベントの検知をすることが可能です。サンプルとして次のようなカスタム分析ルールが Microsoft 技術ブログでも紹介されていますのでぜひ参考にしてみてください。</p><ul><li>リポジトリに対する異常数のクローン操作</li><li>リポジトリの一括削除</li><li>リポジトリをプライベートからパブリックに変更</li><li>リポジトリに対する部外者からのフォーク操作</li><li>GitHub Organization へのユーザ招待およびユーザ追加</li><li>ユーザへのアクセス許可の追加付与　など</li></ul><p><a href=https://techcommunity.microsoft.com/t5/microsoft-sentinel-blog/protecting-your-github-assets-with-azure-sentinel/ba-p/1457721>https://techcommunity.microsoft.com/t5/microsoft-sentinel-blog/protecting-your-github-assets-with-azure-sentinel/ba-p/1457721</a></p><h1 id=終わりに>終わりに<a hidden class=anchor aria-hidden=true href=#終わりに>#</a></h1><p>今回は GitHub Enterprise Cloud の各種ログを SIEM マネージドサービスである Microsoft Sentinel (旧称 Azure Sentinel) に集約し、サイバー攻撃の兆候を検知できるようにする方法のご紹介でしたがいかがだったでしょうか？</p><p>GitHub Enterprise Cloud に限らず様々な監査ログを収集し、長期保存されている方は多いと思います。ただ、せっかく取得するのであればただ集めて長期保存しておくだけではなく、Microsoft Sentinel を活用してもう一歩進んだセキュアな環境を実現してみる、というのも &ldquo;有り&rdquo; なのではないでしょうか。</p><p>以上、「Microsoft Sentinel を使って GitHub Enterprise Cloud のセキュリティを強化しよう (Azure Logic Apps 編)」でした。</p><hr><ul><li>Microsoft Azure は，Microsoft Corporation の商標または登録商標です。</li><li>GitHub は、GitHub Inc. の商標または登録商標です。</li><li>その他、本資料に記述してある会社名、製品名は、各社の登録商品または商標です。</li></ul><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p>SIEM(Security Information and Event Management) は、様々なログを一元的に集約、相関分析をしてサイバー攻撃などの異常を自動的に検出するソリューションです。&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></div><footer class=post-footer><ul class=post-tags><li><a href=https://chacco38.github.io/tags/azure/>Azure</a></li><li><a href=https://chacco38.github.io/tags/microsoft-sentinel/>Microsoft Sentinel</a></li><li><a href=https://chacco38.github.io/tags/github/>GitHub</a></li><li><a href=https://chacco38.github.io/tags/azure-logic-apps/>Azure Logic Apps</a></li></ul><nav class=paginav><a class=prev href=https://chacco38.github.io/posts/2021/12/gcp-asm-with-gke-autopilot/><span class=title>« Prev Page</span><br><span>GKE Autopilot と Anthos Service Mesh を使ってフルマネージドなサービスメッシュ環境を構築してみた</span></a>
<a class=next href=https://chacco38.github.io/posts/2021/11/azure-sentinel-functions-data-connector-for-ghec/><span class=title>Next Page »</span><br><span>Microsoft Sentinel を使って GitHub Enterprise Cloud のセキュリティを強化しよう (Azure Functions コネクタ編)</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Microsoft Sentinel を使って GitHub Enterprise Cloud のセキュリティを強化しよう (Azure Logic Apps コネクタ編) on twitter" href="https://twitter.com/intent/tweet/?text=Microsoft%20Sentinel%20%e3%82%92%e4%bd%bf%e3%81%a3%e3%81%a6%20GitHub%20Enterprise%20Cloud%20%e3%81%ae%e3%82%bb%e3%82%ad%e3%83%a5%e3%83%aa%e3%83%86%e3%82%a3%e3%82%92%e5%bc%b7%e5%8c%96%e3%81%97%e3%82%88%e3%81%86%20%28Azure%20Logic%20Apps%20%e3%82%b3%e3%83%8d%e3%82%af%e3%82%bf%e7%b7%a8%29&url=https%3a%2f%2fchacco38.github.io%2fposts%2f2021%2f11%2fazure-sentinel-logicapps-data-connector-for-ghec%2f&hashtags=Azure%2cMicrosoftSentinel%2cGitHub%2cAzureLogicApps"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Microsoft Sentinel を使って GitHub Enterprise Cloud のセキュリティを強化しよう (Azure Logic Apps コネクタ編) on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fchacco38.github.io%2fposts%2f2021%2f11%2fazure-sentinel-logicapps-data-connector-for-ghec%2f&title=Microsoft%20Sentinel%20%e3%82%92%e4%bd%bf%e3%81%a3%e3%81%a6%20GitHub%20Enterprise%20Cloud%20%e3%81%ae%e3%82%bb%e3%82%ad%e3%83%a5%e3%83%aa%e3%83%86%e3%82%a3%e3%82%92%e5%bc%b7%e5%8c%96%e3%81%97%e3%82%88%e3%81%86%20%28Azure%20Logic%20Apps%20%e3%82%b3%e3%83%8d%e3%82%af%e3%82%bf%e7%b7%a8%29&summary=Microsoft%20Sentinel%20%e3%82%92%e4%bd%bf%e3%81%a3%e3%81%a6%20GitHub%20Enterprise%20Cloud%20%e3%81%ae%e3%82%bb%e3%82%ad%e3%83%a5%e3%83%aa%e3%83%86%e3%82%a3%e3%82%92%e5%bc%b7%e5%8c%96%e3%81%97%e3%82%88%e3%81%86%20%28Azure%20Logic%20Apps%20%e3%82%b3%e3%83%8d%e3%82%af%e3%82%bf%e7%b7%a8%29&source=https%3a%2f%2fchacco38.github.io%2fposts%2f2021%2f11%2fazure-sentinel-logicapps-data-connector-for-ghec%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Microsoft Sentinel を使って GitHub Enterprise Cloud のセキュリティを強化しよう (Azure Logic Apps コネクタ編) on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fchacco38.github.io%2fposts%2f2021%2f11%2fazure-sentinel-logicapps-data-connector-for-ghec%2f&title=Microsoft%20Sentinel%20%e3%82%92%e4%bd%bf%e3%81%a3%e3%81%a6%20GitHub%20Enterprise%20Cloud%20%e3%81%ae%e3%82%bb%e3%82%ad%e3%83%a5%e3%83%aa%e3%83%86%e3%82%a3%e3%82%92%e5%bc%b7%e5%8c%96%e3%81%97%e3%82%88%e3%81%86%20%28Azure%20Logic%20Apps%20%e3%82%b3%e3%83%8d%e3%82%af%e3%82%bf%e7%b7%a8%29"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Microsoft Sentinel を使って GitHub Enterprise Cloud のセキュリティを強化しよう (Azure Logic Apps コネクタ編) on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fchacco38.github.io%2fposts%2f2021%2f11%2fazure-sentinel-logicapps-data-connector-for-ghec%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Microsoft Sentinel を使って GitHub Enterprise Cloud のセキュリティを強化しよう (Azure Logic Apps コネクタ編) on whatsapp" href="https://api.whatsapp.com/send?text=Microsoft%20Sentinel%20%e3%82%92%e4%bd%bf%e3%81%a3%e3%81%a6%20GitHub%20Enterprise%20Cloud%20%e3%81%ae%e3%82%bb%e3%82%ad%e3%83%a5%e3%83%aa%e3%83%86%e3%82%a3%e3%82%92%e5%bc%b7%e5%8c%96%e3%81%97%e3%82%88%e3%81%86%20%28Azure%20Logic%20Apps%20%e3%82%b3%e3%83%8d%e3%82%af%e3%82%bf%e7%b7%a8%29%20-%20https%3a%2f%2fchacco38.github.io%2fposts%2f2021%2f11%2fazure-sentinel-logicapps-data-connector-for-ghec%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Microsoft Sentinel を使って GitHub Enterprise Cloud のセキュリティを強化しよう (Azure Logic Apps コネクタ編) on telegram" href="https://telegram.me/share/url?text=Microsoft%20Sentinel%20%e3%82%92%e4%bd%bf%e3%81%a3%e3%81%a6%20GitHub%20Enterprise%20Cloud%20%e3%81%ae%e3%82%bb%e3%82%ad%e3%83%a5%e3%83%aa%e3%83%86%e3%82%a3%e3%82%92%e5%bc%b7%e5%8c%96%e3%81%97%e3%82%88%e3%81%86%20%28Azure%20Logic%20Apps%20%e3%82%b3%e3%83%8d%e3%82%af%e3%82%bf%e7%b7%a8%29&url=https%3a%2f%2fchacco38.github.io%2fposts%2f2021%2f11%2fazure-sentinel-logicapps-data-connector-for-ghec%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>© 2022 Satoshi Matsuzawa</span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(t=>{const n=t.parentNode.parentNode,e=document.createElement("button");e.classList.add("copy-code"),e.innerText="copy";function s(){e.innerText="copied!",setTimeout(()=>{e.innerText="copy"},2e3)}e.addEventListener("click",o=>{if("clipboard"in navigator){navigator.clipboard.writeText(t.textContent),s();return}const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e);try{document.execCommand("copy"),s()}catch(e){}n.removeRange(e)}),n.classList.contains("highlight")?n.appendChild(e):n.parentNode.firstChild==n||(t.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?t.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e):t.parentNode.appendChild(e))})</script></body></html>